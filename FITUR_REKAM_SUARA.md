# ğŸ¤ Fitur Rekam Suara Custom

## ğŸ¯ Overview

Operator sekarang bisa **merekam suara sendiri** atau **upload file audio** untuk pemanggilan antrian yang lebih personal dan profesional!

---

## âœ¨ Fitur Baru:

### **1. Rekam Suara Langsung** ğŸ¤
- âœ… Rekam langsung dari browser
- âœ… Real-time recording dengan timer
- âœ… Format audio: WebM (Opus codec)
- âœ… Kualitas tinggi

### **2. Upload File Audio** ğŸ“
- âœ… Upload file audio yang sudah ada
- âœ… Support format: MP3, WAV, OGG, WebM, dll
- âœ… Maksimal 5MB per file
- âœ… Validasi otomatis

### **3. Playback & Preview** â–¶ï¸
- âœ… Putar rekaman sebelum simpan
- âœ… Test audio sebelum digunakan
- âœ… Kontrol play/pause

### **4. Management Audio** ğŸ—‚ï¸
- âœ… Hapus rekaman
- âœ… Download rekaman
- âœ… Replace rekaman lama
- âœ… Per layanan (4 layanan)

### **5. Toggle Custom Audio** ğŸ”„
- âœ… Enable/disable audio custom
- âœ… Fallback ke TTS otomatis
- âœ… Fleksibel per kebutuhan

---

## ğŸ“‹ Layanan yang Didukung:

### **1. Pemanggilan Penghadapan**
**Template Lengkap:**
```
"Pemanggilan layanan penghadapan.
Nomor antrian P H 001.
Atas nama Budi Santoso.
Pembimbing kemasyarakatan Ahmad Fauzi.
Silakan menuju ke loket 1.
Mohon membawa dokumen yang diperlukan."
```

### **2. Pemanggilan Bimbingan**
**Template Lengkap:**
```
"Pemanggilan layanan bimbingan.
Nomor antrian B M W L 001.
Klien atas nama Ujang.
Jenis bimbingan wajib lapor.
Pembimbing kemasyarakatan Budi Santoso.
Silakan menuju ke ruang bimbingan loket 1.
Mohon membawa KTP dan dokumen pendukung."
```

### **3. Pemanggilan Kunjungan**
**Template Lengkap:**
```
"Pemanggilan layanan kunjungan.
Nomor antrian K J 001.
Pengunjung atas nama Siti Aminah.
Keperluan kunjungan keluarga.
Silakan menuju ke loket 1.
Mohon membawa KTP dan surat izin kunjungan."
```

### **4. Pemanggilan Pengaduan**
**Template Lengkap:**
```
"Pemanggilan layanan pengaduan.
Nomor antrian P G 001.
Atas nama Ahmad Yani.
Jenis pengaduan layanan.
Silakan menuju ke loket 1.
Mohon siapkan dokumen pendukung pengaduan."
```

---

## ğŸ“ Konsep: Template Pemanggilan dalam Bahasa Indonesia

### **Apa itu Template Pemanggilan?**

Template pemanggilan adalah **format lengkap pesan** yang akan disampaikan saat memanggil antrian. Bukan hanya nomor antrian, tapi **semua informasi penting** dalam bahasa Indonesia yang mudah dipahami.

### **Mengapa Template Lengkap?**

1. **Informasi Lengkap** - Klien tahu semua detail (nama, layanan, PK, loket)
2. **Profesional** - Terdengar formal dan terstruktur
3. **Jelas** - Tidak ada kebingungan tentang apa yang harus dilakukan
4. **Konsisten** - Setiap pemanggilan mengikuti format yang sama

### **Struktur Template:**

```
1. Pembukaan: "Pemanggilan layanan [nama layanan]"
2. Nomor Antrian: "Nomor antrian [kode]-[nomor]"
3. Identitas: "Atas nama [nama klien]"
4. Info Layanan: [Detail spesifik per layanan]
5. Instruksi: "Silakan menuju ke [lokasi]"
6. Penutup: [Instruksi tambahan]
```

### **Panduan per Layanan:**

| Layanan | Info Wajib | Info Tambahan |
|---------|-----------|---------------|
| **Penghadapan** | Nomor, Nama, PK | Jabatan PK, Dokumen |
| **Bimbingan** | Nomor, Nama, Jenis, PK | Ruang bimbingan, KTP |
| **Kunjungan** | Nomor, Nama, Keperluan | Surat izin |
| **Pengaduan** | Nomor, Nama, Jenis | Dokumen pendukung |

---

## ğŸš€ Cara Menggunakan:

### **STEP 1: Buka Tab Rekam Suara**

```
1. Login ke Dashboard Operator
2. Klik "Pengaturan" (âš™ï¸)
3. Klik tab "Rekam Suara" (ğŸ¤)
```

### **STEP 2: Rekam Template Lengkap**

#### **Opsi A: Rekam Langsung**
```
1. Pilih layanan (misal: Penghadapan)
2. Klik "Mulai Rekam" ğŸ¤
3. Browser minta izin mikrofon â†’ Izinkan
4. Timer mulai berjalan (0:00)
5. Bicara dengan jelas sesuai TEMPLATE LENGKAP:
   
   "Pemanggilan layanan penghadapan.
   Nomor antrian P H 001.
   Atas nama Budi Santoso.
   Pembimbing kemasyarakatan Ahmad Fauzi.
   Silakan menuju ke loket 1.
   Mohon membawa dokumen yang diperlukan."

6. Klik "Stop Rekam" â¹ï¸
7. âœ… Rekaman template tersimpan otomatis!
```

**ğŸ’¡ Tips:**
- Lihat tab "Template" untuk panduan format lengkap
- Sesuaikan dengan data contoh yang relevan
- Durasi ideal: 10-15 detik untuk template lengkap

#### **Opsi B: Upload File**
```
1. Pilih layanan
2. Klik "Upload Audio" ğŸ“
3. Pilih file audio dari komputer
4. File ter-upload otomatis
5. âœ… Audio tersimpan!
```

### **STEP 3: Preview Audio**

```
1. Setelah rekam/upload
2. Klik "Putar" â–¶ï¸
3. Dengar rekaman
4. Jika tidak puas:
   - Klik "Hapus" ğŸ—‘ï¸
   - Rekam ulang
```

### **STEP 4: Aktifkan Audio Custom**

```
1. Toggle "Gunakan Audio Custom" â†’ ON âœ…
2. Klik "Simpan Semua" ğŸ’¾
3. âœ… Audio custom aktif!
```

### **STEP 5: Test di Operator Dashboard**

```
1. Kembali ke /operator
2. Panggil antrian
3. ğŸ”Š Audio custom Anda akan diputar!
```

---

## ğŸ¨ UI Features:

### **Card Rekam Suara:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pemanggilan Penghadapan             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ¤ Mulai Rekam] [ğŸ“ Upload Audio] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Saat Merekam:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pemanggilan Penghadapan    ğŸ”´ 0:15  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â¹ï¸ Stop Rekam]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Setelah Rekam:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pemanggilan Penghadapan             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â–¶ï¸ Putar] [â¬‡ï¸ Download] [ğŸ—‘ï¸ Hapus] â”‚
â”‚ âœ… Audio tersimpan                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ Tips Rekam Suara:

### **1. Persiapan:**
- âœ… Ruangan tenang (no noise)
- âœ… Mikrofon berkualitas
- âœ… Jarak mikrofon 15-20cm dari mulut
- âœ… Test mikrofon dulu

### **2. Saat Merekam:**
- âœ… Bicara jelas dan pelan
- âœ… Intonasi natural
- âœ… Volume stabil
- âœ… Tidak terlalu cepat

### **3. Format Template Lengkap:**
```
"Pemanggilan layanan [nama layanan].
Nomor antrian [kode]-[nomor].
Atas nama [nama klien].
[Info tambahan sesuai layanan].
Silakan menuju ke [lokasi].
[Instruksi tambahan]."
```

**Contoh Penghadapan:**
```
"Pemanggilan layanan penghadapan.
Nomor antrian P H 001.
Atas nama Budi Santoso.
Pembimbing kemasyarakatan Ahmad Fauzi.
Silakan menuju ke loket 1.
Mohon membawa dokumen yang diperlukan."
```

### **4. Durasi:**
- âœ… Ideal: 5-10 detik
- âœ… Tidak terlalu panjang
- âœ… Tidak terlalu pendek

---

## ğŸ”§ Technical Details:

### **Recording:**
```typescript
// MediaRecorder API
const mediaRecorder = new MediaRecorder(stream, {
  mimeType: 'audio/webm;codecs=opus'
});
```

### **Storage:**
```typescript
// Convert to base64 for localStorage
const reader = new FileReader();
reader.onloadend = () => {
  const base64 = reader.result as string;
  localStorage.setItem('customAudioSettings', base64);
};
```

### **Playback:**
```typescript
// Play custom audio
const audio = new Audio(audioData);
audio.play();

// Fallback to TTS if no custom audio
if (!played) {
  speechSynthesis.speak(utterance);
}
```

---

## ğŸ”„ Flow Lengkap:

```
Operator Login
    â†“
Klik "Pengaturan"
    â†“
Tab "Rekam Suara"
    â†“
Pilih Layanan
    â†“
Rekam/Upload Audio
    â†“
Preview (Putar)
    â†“
Puas? â†’ Simpan
Tidak? â†’ Hapus & Rekam Ulang
    â†“
Toggle "Gunakan Audio Custom" ON
    â†“
Klik "Simpan Semua"
    â†“
Kembali ke Dashboard
    â†“
Panggil Antrian
    â†“
ğŸ”Š Audio Custom Diputar!
    â†“
âœ… Pemanggilan Profesional!
```

---

## ğŸ“Š Data Storage:

### **LocalStorage Structure:**
```javascript
customAudioSettings: {
  penghadapan: "data:audio/webm;base64,GkXf...",
  bimbingan: "data:audio/webm;base64,GkXf...",
  kunjungan: "data:audio/webm;base64,GkXf...",
  pengaduan: "data:audio/webm;base64,GkXf...",
  useCustomAudio: true
}
```

### **File Size:**
- Recording: ~100KB per 10 detik
- Upload: Max 5MB
- Storage: Base64 encoded

---

## ğŸ¯ Keuntungan:

### **1. Personalisasi** ğŸ¨
- Suara operator sendiri
- Lebih personal
- Brand voice konsisten

### **2. Profesional** âœ¨
- Kualitas audio tinggi
- Tidak robotic
- Intonasi natural

### **3. Fleksibel** ğŸ”„
- Bisa ganti kapan saja
- Per layanan berbeda
- Enable/disable mudah

### **4. Offline Ready** ğŸ“´
- Tersimpan lokal
- Tidak perlu internet
- Cepat diakses

---

## ğŸ§ª Testing Guide:

### **Test 1: Rekam Suara**
```
1. Tab "Rekam Suara"
2. Pilih "Penghadapan"
3. Klik "Mulai Rekam"
4. Bicara: "Nomor antrian P H 001..."
5. Klik "Stop Rekam"
6. âœ… Rekaman tersimpan
```

### **Test 2: Preview**
```
1. Setelah rekam
2. Klik "Putar"
3. Dengar rekaman
4. âœ… Audio terdengar jelas
```

### **Test 3: Upload File**
```
1. Pilih "Bimbingan"
2. Klik "Upload Audio"
3. Pilih file MP3
4. âœ… File ter-upload
```

### **Test 4: Playback di Operator**
```
1. Toggle "Gunakan Audio Custom" ON
2. Simpan
3. Kembali ke /operator
4. Panggil antrian Penghadapan
5. âœ… Audio custom diputar!
```

### **Test 5: Fallback**
```
1. Panggil antrian Kunjungan (no audio)
2. âœ… TTS fallback bekerja
```

---

## âš ï¸ Troubleshooting:

### **Problem 1: Mikrofon Tidak Berfungsi**

**Penyebab:**
- Izin mikrofon ditolak
- Mikrofon tidak terdeteksi
- Browser tidak support

**Solusi:**
```
1. Chrome: chrome://settings/content/microphone
   - Allow untuk situs ini
2. Refresh halaman
3. Klik "Mulai Rekam" lagi
4. Izinkan saat popup muncul
```

### **Problem 2: Audio Tidak Diputar**

**Penyebab:**
- Toggle "Gunakan Audio Custom" OFF
- Rekaman corrupt
- Browser issue

**Solusi:**
```
1. Cek toggle ON
2. Simpan ulang
3. Test dengan "Putar"
4. Rekam ulang jika perlu
```

### **Problem 3: File Upload Gagal**

**Penyebab:**
- File terlalu besar (>5MB)
- Format tidak didukung
- File corrupt

**Solusi:**
```
1. Compress file audio
2. Convert ke MP3/WAV
3. Max 5MB
4. Coba file lain
```

---

## ğŸ“± Browser Support:

### **Chrome/Edge:**
- âœ… MediaRecorder API
- âœ… Opus codec
- âœ… Full support

### **Firefox:**
- âœ… MediaRecorder API
- âœ… Full support
- âš ï¸ Format berbeda

### **Safari:**
- âš ï¸ Limited support
- âš ï¸ Perlu polyfill
- âœ… Upload file OK

---

## ğŸ‰ Summary:

### **Fitur Lengkap:**
- âœ… Rekam suara langsung
- âœ… Upload file audio
- âœ… Preview/playback
- âœ… Download rekaman
- âœ… Hapus rekaman
- âœ… Per layanan (4 layanan)
- âœ… Toggle enable/disable
- âœ… Fallback ke TTS
- âœ… Storage di localStorage
- âœ… Base64 encoding

### **Manfaat:**
- ğŸ¨ Personalisasi tinggi
- âœ¨ Profesional
- ğŸ”Š Kualitas audio baik
- ğŸ”„ Fleksibel
- âš¡ Cepat & offline

---

**Fitur Rekam Suara Custom siap digunakan!** ğŸ¤ğŸš€

Akses: http://localhost:8080/operator-settings â†’ Tab "Rekam Suara"

Rekam suara Anda sendiri untuk pemanggilan yang lebih personal dan profesional!
